{"version":3,"sources":["clAdapters/office365Adapter.js"],"names":[],"mappings":"AAAA,YAAY,CAAC;;;;AAEb,IAAI,IAAI,GAAG,OAAO,CAAC,WAAW,CAAC,CAAC;AAChC,IAAI,MAAM,GAAG,OAAO,CAAC,QAAQ,CAAC,CAAC;AAC/B,IAAI,EAAE,GAAG,OAAO,CAAC,iBAAiB,CAAC,CAAC;AACpC,IAAI,IAAI,GAAG,OAAO,CAAC,MAAM,CAAC,CAAC;AAC3B,IAAI,WAAW,GAAG,OAAO,CAAC,eAAe,CAAC,CAAC;AAC3C,IAAI,SAAS,GAAG,OAAO,CAAC,mBAAmB,CAAC,CAAC;AAC7C,IAAI,MAAM,GAAG,OAAO,CAAC,QAAQ,CAAC,CAAC;;;;;;;;AAQ/B,IAAI,gBAAgB,GAAG,MAAM,CAAC,OAAO,GAAG,SAAS,gBAAgB,GAAG;AAClE,aAAW,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;CACxB,CAAC;;AAEF,IAAI,CAAC,QAAQ,CAAC,gBAAgB,EAAE,WAAW,CAAC,CAAC;;;;;AAK7C,gBAAgB,CAAC,SAAS,CAAC,IAAI,GAAG,YAAW;AAC3C,MAAI,KAAK,GAAG,IAAI,CAAC;AACjB,MAAI,CAAC,OAAO,GAAG,IAAI,SAAS,CAAC,aAAa,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;AAC7D,MAAI,CAAC,QAAQ,GAAG,IAAI,SAAS,CAAC,OAAO,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;AACpD,SAAO,IAAI,CAAC,QAAQ,CACjB,IAAI,EAAE,CACN,IAAI,CAAC,sBAAuB;AAC3B,QAAI,GAAG,GAAG,kDAAkD,CAAC;AAC7D,WAAO,CAAC,GAAG,CAAC,GAAG,EAAE,KAAK,CAAC,WAAW,CAAC,KAAK,CAAC,CAAC;AAC1C,WAAO,KAAK,CAAC;GACd,CAAC,CAAC;CACN,CAAC;;;;;AAKF,gBAAgB,CAAC,SAAS,CAAC,KAAK,GAAG,YAAW;AAC5C,SAAO,IAAI,CAAC,OAAO,CAAC;AACpB,SAAO,IAAI,CAAC,QAAQ,CAAC;CACtB,CAAC;;AAEF,IAAI,aAAa,GAAG,SAAhB,aAAa,CAAY,UAAU,EAAE,KAAK,EAAE,eAAe,EAAE,aAAa,EAAE,gBAAgB,EAAE,MAAM,EAAE,KAAK,EAAE,SAAS,EAAE;AAC1H,MAAI,cAAc,GAAG,EAAE,CAAC;AACxB,MAAI,QAAQ,GAAG,EAAE,CAAC;AAClB,WAAS,GAAG,SAAS,IAAI,CAAC,CAAC;AAC3B,MAAI,IAAI,GAAG,AAAC,CAAC,SAAS,GAAE,CAAC,CAAA,GAAI,cAAc,GAAI,CAAC,CAAC;AACjD,MAAI,mBAAmB,GAAG;AACxB,UAAM,EAAE,KAAK;AACb,OAAG,EAAE,qCAAqC,GAAG,UAAU,GAAG,WAAW,GAAG,KAAK,GAAG,oBAAoB,GAAG,cAAc,GAAG,SAAS,GAAG,IAAI,GAAG,gDAAgD,GAAG,eAAe,CAAC,WAAW,EAAE,CAAC,SAAS,CAAC,CAAC,EAAE,EAAE,CAAC,GAAG,uBAAuB,GAAG,aAAa,CAAC,WAAW,EAAE,CAAC,SAAS,CAAC,CAAC,EAAE,EAAE,CAAC,GAAG,2PAA2P,GAAG,gBAAgB;AACtkB,WAAO,EAAG;AACR,mBAAa,EAAE,SAAS,GAAG,KAAK;AAChC,YAAM,EAAE,sCAAsC;KAC/C;GACF,CAAC;AACF,SAAO,EAAE,CAAC,mBAAmB,CAAC,CAC7B,IAAI,CAAC,UAAS,IAAI,EAAE;AACnB,UAAM,CAAC,OAAO,GAAG,IAAI,CAAC;AACtB,QAAI,UAAU,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;;AAElC,QAAI,UAAU,IAAI,SAAS,KAAK,CAAC,EAAE;AACjC,YAAM,CAAC,IAAI,GAAG,UAAU,CAAC;KAC1B,MAAM,IAAI,UAAU,CAAC,KAAK,IAAI,SAAS,GAAG,CAAC,EAAE;AAC5C,YAAM,CAAC,IAAI,CAAC,KAAK,GAAG,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC;KAChE;;AAED,QAAI,UAAU,IAAI,UAAU,CAAC,KAAK,CAAC,MAAM,KAAK,cAAc,IAAI,SAAS,IAAI,QAAQ,EAAE;AACrF,aAAO,aAAa,CAAC,UAAU,EAAE,KAAK,EAAE,eAAe,EAAE,aAAa,EAAE,gBAAgB,EAAE,MAAM,EAAE,KAAK,EAAE,SAAS,GAAG,CAAC,CAAC,CAAC;KACzH,MAAM;AACL,aAAO,IAAI,CAAC;KACb;GACF,CAAC,SACI,CAAC,UAAS,GAAG,EAAE;AACnB,UAAM,CAAC,OAAO,GAAG,KAAK,CAAC;AACvB,QAAI,GAAG,CAAC,IAAI,KAAK,iBAAiB,EAAE;AAClC,UAAI,aAAa,GAAG,GAAG,CAAC,OAAO,CAAC;AAChC,UAAI,WAAW,GAAG,aAAa,CAAC,OAAO,CAAC,GAAG,CAAC,UAAU,GAAG,KAAK,EAAE,EAAE,CAAC,CAAC;AACpE,UAAI,WAAW,GAAG,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC,OAAO,CAAC,IAAI,MAAM,CAAC,KAAK,EAAE,GAAG,CAAC,EAAC,GAAG,CAAC,CAAC,CAAC;AAC9E,YAAM,CAAC,YAAY,GAAG,WAAW,CAAC,KAAK,CAAC,OAAO,CAAC;KACjD,MAAM;AACL,YAAM,CAAC,YAAY,GAAG,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,CAAC;KAC3C;AACD,WAAO,IAAI,CAAC;GACb,CAAC,CAAC;CACJ,CAAC;;AAEF,IAAI,cAAc,GAAG,SAAjB,cAAc,CAAY,UAAU,EAAE,QAAQ,EAAE,QAAQ,EAAE,cAAc,EAAE,UAAU,EAAE;AACxF,MAAI,eAAe,GAAG,oCAAoC,GAAG,QAAQ,GAAG,4BAA4B,GAAG,UAAU,CAAC;;AAElH,MAAI,SAAS,GAAG;AACd,SAAK,EAAE,OAAO;AACd,SAAK,EAAE,cAAc;GACtB,CAAC;;AAEF,MAAI,UAAU,GAAG;AACf,SAAK,EAAE,eAAe;AACtB,SAAK,EAAE,AAAC,AAAC,IAAI,IAAI,EAAE,CAAE,OAAO,EAAE,GAAG,IAAI,GAAI,MAAM;AAC/C,SAAK,EAAE,QAAQ;AACf,SAAK,EAAE,IAAI,CAAC,EAAE,EAAE;AAChB,SAAK,EAAE,AAAC,AAAC,IAAI,IAAI,EAAE,CAAE,OAAO,EAAE,GAAG,IAAI,GAAI,MAAM;AAC/C,SAAK,EAAE,QAAQ;GAChB,CAAC;;AAEF,MAAI,gBAAgB,GAAG,IAAI,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC,SAAS,CAAC,CAAC,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC;AAChF,MAAI,iBAAiB,GAAG,IAAI,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC,UAAU,CAAC,CAAC,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC;AAClF,MAAI,YAAY,GAAG,gBAAgB,GAAG,GAAG,GAAG,iBAAiB,CAAC;;;AAG9D,MAAI,MAAM,GAAG,MAAM,CAAC,UAAU,CAAC,YAAY,CAAC,CAAC;AAC7C,QAAM,CAAC,MAAM,CAAC,YAAY,CAAC,CAAC;AAC5B,MAAI,oBAAoB,GAAG,MAAM,CAAC,IAAI,CAAC,UAAU,EAAE,QAAQ,CAAC,CAAC;;;AAG7D,MAAI,eAAe,GAAG,gBAAgB,GAAG,GAAG,GAAG,iBAAiB,GAAG,GAAG,GAAG,oBAAoB,CAAC;;AAE9F,MAAI,oBAAoB,GAAG;AACzB,aAAS,EAAE,QAAQ;AACnB,yBAAqB,EAAE,wDAAwD;AAC/E,cAAU,EAAE,oBAAoB;AAChC,YAAQ,EAAE,gCAAgC;AAC1C,oBAAgB,EAAE,eAAe;GAClC,CAAC;;AAEF,MAAI,mBAAmB,GAAG;AACxB,UAAM,EAAE,MAAM;AACd,QAAI,EAAE,GAAG;AACT,OAAG,EAAE,eAAe;AACpB,YAAQ,EAAE,oBAAoB;GAC/B,CAAC;;AAEF,SAAO,EAAE,CAAC,mBAAmB,CAAC,CAC7B,IAAI,CAAC,UAAS,IAAI,EAAE;AACnB,QAAI,SAAS,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;AACjC,QAAI,SAAS,IAAI,SAAS,CAAC,YAAY,EAAE;AACvC,UAAI,WAAW,GAAG,SAAS,CAAC,YAAY,CAAC;AACzC,aAAO,WAAW,CAAC;KACpB,MAAM;AACL,aAAO,SAAQ,MAAM,CAAC,6BAA6B,CAAC,CAAC;KACtD;GACF,CAAC,SACI,CAAC,UAAS,GAAG,EAAE;AACnB,QAAI,SAAS,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,CAAC,CAAC;AAChD,QAAI,SAAS,CAAC,IAAI,KAAK,iBAAiB,EAAE;AACxC,UAAI,aAAa,GAAG,SAAS,CAAC,OAAO,CAAC;AACtC,UAAI,WAAW,GAAG,aAAa,CAAC,OAAO,CAAC,SAAS,CAAC,UAAU,GAAG,KAAK,EAAE,EAAE,CAAC,CAAC;AAC1E,UAAI,WAAW,GAAG,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC,OAAO,CAAC,IAAI,MAAM,CAAC,KAAK,EAAE,GAAG,CAAC,EAAC,GAAG,CAAC,CAAC,CAAC;;;AAG9E,aAAO,SAAQ,MAAM,CAAC,WAAW,CAAC,CAAC;KACpC,MAAM;AACL,aAAO,SAAQ,MAAM,CAAC,GAAG,CAAC,CAAC;KAC5B;GACF,CAAC,CAAC;CACJ,CAAC;;AAEF,IAAI,2BAA2B,GAAG,SAA9B,2BAA2B,CAAY,YAAY,EAAE,OAAO,EAAE;AAChE,MAAI,OAAO,KAAK,EAAE,EAAE;AAClB,WAAO,EAAE,CAAC;GACX,MAAM,IAAI,OAAO,CAAC,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC,EAAE;AACtC,WAAO,YAAY,CAAC,OAAO,CAAC,CAAC;GAC9B,MAAM;;AAEL,QAAI,mBAAmB,GAAG,OAAO,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;AAC7C,QAAI,SAAS,GAAG,YAAY,CAAC,mBAAmB,CAAC,CAAC,CAAC,CAAC,CAAC;AACrD,QAAI,SAAS,EAAE;AACb,WAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,mBAAmB,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;AACnD,iBAAS,GAAG,SAAS,CAAC,mBAAmB,CAAC,CAAC,CAAC,CAAC,CAAC;AAC9C,YAAI,CAAC,SAAS,EAAE;AACd,iBAAO,SAAS,CAAC;SAClB;OACF;KACF;AACD,WAAO,SAAS,CAAC;GAClB;CACF,CAAC;;AAEF,IAAI,YAAY,GAAG,SAAf,YAAY,CAAY,SAAS,EAAE;AACrC,MAAI,OAAO,GAAG;AACZ,YAAQ,EAAE,OAAO;AACjB,eAAW,EAAE,IAAI;AACjB,oBAAgB,EAAE,gBAAgB;AAClC,kBAAc,EAAE,cAAc;AAC9B,sBAAkB,EAAE,kBAAkB;AACtC,gBAAY,EAAE,YAAY;AAC1B,cAAU,EAAE,gBAAgB;AAC5B,gBAAY,EAAE,EAAE;AAChB,gBAAY,EAAE,YAAY;AAC1B,iBAAa,EAAE,kBAAkB;AACjC,aAAS,EAAE,SAAS;AACpB,iBAAa,EAAE,aAAa;AAC5B,UAAM,EAAE,cAAc;AACtB,iBAAa,EAAE,2BAA2B;AAC1C,cAAU,EAAE,wBAAwB;AACpC,kBAAc,EAAE,cAAc;AAC9B,wBAAoB,EAAE,sBAAsB;AAC5C,qBAAiB,EAAE,mBAAmB;AACtC,kBAAc,EAAE,cAAc;AAC9B,wBAAoB,EAAE,sBAAsB;AAC5C,qBAAiB,EAAE,mBAAmB;AACtC,mBAAe,EAAE,eAAe;AAChC,yBAAqB,EAAE,sBAAsB;AAC7C,sBAAkB,EAAE,mBAAmB;AACvC,gCAA4B,EAAE,4BAA4B;AAC1D,4BAAwB,EAAE,wBAAwB;AAClD,oBAAgB,EAAE,gBAAgB;AAClC,aAAS,EAAE,SAAS;AACpB,YAAQ,EAAE,QAAQ;GACnB,CAAC;;AAEF,MAAI,UAAU,GAAG,EAAE,CAAC;;AAEpB,OAAK,IAAI,QAAQ,GAAG,CAAC,EAAE,QAAQ,GAAG,SAAS,CAAC,MAAM,EAAE,QAAQ,EAAE,EAAE;AAC9D,QAAI,UAAU,GAAG;AACf,WAAK,EAAE,SAAS,CAAC,QAAQ,CAAC,CAAC,KAAK;AAChC,qBAAe,EAAE,SAAS,CAAC,QAAQ,CAAC,CAAC,eAAe;AACpD,mBAAa,EAAE,SAAS,CAAC,QAAQ,CAAC,CAAC,aAAa;AAChD,UAAI,EAAE,EAAE;AACR,aAAO,EAAE,SAAS,CAAC,QAAQ,CAAC,CAAC,OAAO;AACpC,kBAAY,EAAE,SAAS,CAAC,QAAQ,CAAC,CAAC,YAAY;KAC/C,CAAC;;AAEF,QAAI,SAAS,CAAC,QAAQ,CAAC,CAAC,OAAO,EAAE;AAC/B,WAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,SAAS,CAAC,QAAQ,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;AACxE,YAAI,oBAAoB,GAAG,SAAS,CAAC,QAAQ,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC;AACvE,YAAI,kBAAkB,GAAG,EAAE,CAAC;;;AAG5B,0BAAkB,CAAC,SAAS,GAAG,2BAA2B,CAAC,oBAAoB,EAAE,OAAO,CAAC,SAAS,CAAC,CAAC;AACpG,0BAAkB,CAAC,cAAc,GAAG,2BAA2B,CAAC,oBAAoB,EAAE,OAAO,CAAC,cAAc,CAAC,CAAC;AAC9G,0BAAkB,CAAC,YAAY,GAAG,IAAI,IAAI,CAAC,2BAA2B,CAAC,oBAAoB,EAAE,OAAO,CAAC,YAAY,CAAC,CAAC,CAAC;AACpH,0BAAkB,CAAC,gBAAgB,GAAG,IAAI,IAAI,CAAC,2BAA2B,CAAC,oBAAoB,EAAE,OAAO,CAAC,gBAAgB,CAAC,CAAC,CAAC;AAC5H,0BAAkB,CAAC,UAAU,GAAG,2BAA2B,CAAC,oBAAoB,EAAE,OAAO,CAAC,UAAU,CAAC,CAAC;AACtG,0BAAkB,CAAC,QAAQ,GAAG,2BAA2B,CAAC,oBAAoB,EAAE,OAAO,CAAC,QAAQ,CAAC,CAAC;;AAElG,0BAAkB,CAAC,UAAU,GAAG,2BAA2B,CAAC,oBAAoB,EAAE,OAAO,CAAC,UAAU,CAAC,CAAC;AACtG,0BAAkB,CAAC,WAAW,GAAG,2BAA2B,CAAC,oBAAoB,EAAE,OAAO,CAAC,WAAW,CAAC,CAAC;AACxG,0BAAkB,CAAC,OAAO,GAAG,2BAA2B,CAAC,oBAAoB,EAAE,OAAO,CAAC,OAAO,CAAC,CAAC;AAChG,0BAAkB,CAAC,WAAW,GAAG,2BAA2B,CAAC,oBAAoB,EAAE,OAAO,CAAC,WAAW,CAAC,CAAC;AACxG,0BAAkB,CAAC,IAAI,GAAG,2BAA2B,CAAC,oBAAoB,EAAE,OAAO,CAAC,IAAI,CAAC,CAAC;AAC1F,0BAAkB,CAAC,0BAA0B,GAAG,2BAA2B,CAAC,oBAAoB,EAAE,OAAO,CAAC,0BAA0B,CAAC,CAAC;AACtI,0BAAkB,CAAC,sBAAsB,GAAG,2BAA2B,CAAC,oBAAoB,EAAE,OAAO,CAAC,sBAAsB,CAAC,CAAC;AAC9H,0BAAkB,CAAC,cAAc,GAAG,2BAA2B,CAAC,oBAAoB,EAAE,OAAO,CAAC,cAAc,CAAC,CAAC;AAC9G,0BAAkB,CAAC,OAAO,GAAG,2BAA2B,CAAC,oBAAoB,EAAE,OAAO,CAAC,OAAO,CAAC,CAAC;AAChG,0BAAkB,CAAC,MAAM,GAAG,2BAA2B,CAAC,oBAAoB,EAAE,OAAO,CAAC,MAAM,CAAC,CAAC;;AAE9F,0BAAkB,CAAC,WAAW,GAAG,2BAA2B,CAAC,oBAAoB,EAAE,OAAO,CAAC,WAAW,CAAC,CAAC;AACxG,0BAAkB,CAAC,QAAQ,GAAG,2BAA2B,CAAC,oBAAoB,EAAE,OAAO,CAAC,QAAQ,CAAC,CAAC;;;AAGlG,YAAI,CAAC,GAAG,CAAC,CAAC;;;AAGV,0BAAkB,CAAC,YAAY,GAAG,EAAE,CAAC;AACrC,aAAK,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,oBAAoB,CAAC,OAAO,CAAC,YAAY,CAAC,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;AACtE,4BAAkB,CAAC,YAAY,CAAC,IAAI,CAAC;AACnC,mBAAO,EAAE,2BAA2B,CAAC,oBAAoB,CAAC,OAAO,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC,EAAE,OAAO,CAAC,kBAAkB,CAAC;AAC/G,gBAAI,EAAE,2BAA2B,CAAC,oBAAoB,CAAC,OAAO,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC,EAAE,OAAO,CAAC,eAAe,CAAC;WAC1G,CAAC,CAAC;SACJ;;;AAGD,0BAAkB,CAAC,YAAY,GAAG,EAAE,CAAC;AACrC,aAAK,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,oBAAoB,CAAC,OAAO,CAAC,YAAY,CAAC,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;AACtE,4BAAkB,CAAC,YAAY,CAAC,IAAI,CAAC;AACnC,mBAAO,EAAE,2BAA2B,CAAC,oBAAoB,CAAC,OAAO,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC,EAAE,OAAO,CAAC,kBAAkB,CAAC;AAC/G,gBAAI,EAAE,2BAA2B,CAAC,oBAAoB,CAAC,OAAO,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC,EAAE,OAAO,CAAC,eAAe,CAAC;WAC1G,CAAC,CAAC;SACJ;;;AAGD,0BAAkB,CAAC,aAAa,GAAG,EAAE,CAAC;AACtC,aAAK,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,oBAAoB,CAAC,OAAO,CAAC,aAAa,CAAC,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;AACvE,4BAAkB,CAAC,aAAa,CAAC,IAAI,CAAC;AACpC,mBAAO,EAAE,2BAA2B,CAAC,oBAAoB,CAAC,OAAO,CAAC,aAAa,CAAC,CAAC,CAAC,CAAC,EAAE,OAAO,CAAC,mBAAmB,CAAC;AACjH,gBAAI,EAAE,2BAA2B,CAAC,oBAAoB,CAAC,OAAO,CAAC,aAAa,CAAC,CAAC,CAAC,CAAC,EAAE,OAAO,CAAC,gBAAgB,CAAC;WAC5G,CAAC,CAAC;SACJ;;AAED,kBAAU,CAAC,IAAI,CAAC,IAAI,CAAC,kBAAkB,CAAC,CAAC;OAC1C;KACF;AACD,cAAU,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;GAC7B;;AAED,SAAO,UAAU,CAAC;CACnB,CAAC;;AAEF,IAAI,YAAY,GAAG,SAAf,YAAY,CAAY,UAAU,EAAE,MAAM,EAAE,eAAe,EAAE,aAAa,EAAE,gBAAgB,EAAE,QAAQ,EAAE,QAAQ,EAAE,cAAc,EAAE,UAAU,EAAE;AAChJ,SAAO,cAAc,CAAC,UAAU,EAAE,QAAQ,EAAE,QAAQ,EAAE,cAAc,EAAE,UAAU,CAAC,CAChF,IAAI,CAAC,UAAS,WAAW,EAAE;AAC1B,QAAI,YAAY,GAAG,EAAE,CAAC;AACtB,QAAI,mBAAmB,GAAG,EAAE,CAAC;AAC7B,QAAI,SAAS,GAAG,CAAC,CAAC;AAClB,SAAK,SAAS,GAAG,CAAC,EAAE,SAAS,GAAG,MAAM,CAAC,MAAM,EAAE,SAAS,EAAE,EAAE;AAC1D,kBAAY,CAAC,SAAS,CAAC,GAAG,EAAC,KAAK,EAAE,MAAM,CAAC,SAAS,CAAC,EAAE,eAAe,EAAE,eAAe,EAAE,aAAa,EAAE,aAAa,EAAC,CAAC;AACrH,yBAAmB,CAAC,IAAI,CAAC,aAAa,CAAC,UAAU,EAAE,MAAM,CAAC,SAAS,CAAC,EAAE,eAAe,EAAE,aAAa,EAAE,gBAAgB,EAAE,YAAY,CAAC,SAAS,CAAC,EAAE,WAAW,CAAC,CAAC,CAAC;KAChK;;AAED,WAAO,SAAQ,GAAG,CAAC,mBAAmB,CAAC,CACtC,IAAI,CAAC,YAAW;AACf,aAAO,YAAY,CAAC;KACrB,CAAC,CAAC;GACJ,CAAC,CAAC;CACJ,CAAC;;AAEF,gBAAgB,CAAC,SAAS,CAAC,YAAY,GAAG,UAAS,MAAM,EAAE,eAAe,EAAE,aAAa,EAAE,gBAAgB,EAAE;AAC3G,MAAI,QAAQ,GAAG,IAAI,CAAC,OAAO,CAAC,WAAW,CAAC,QAAQ,CAAC;AACjD,MAAI,QAAQ,GAAG,IAAI,CAAC,OAAO,CAAC,WAAW,CAAC,QAAQ,CAAC;AACjD,MAAI,cAAc,GAAG,IAAI,CAAC,OAAO,CAAC,WAAW,CAAC,qBAAqB,CAAC;AACpE,MAAI,UAAU,GAAG,IAAI,CAAC,OAAO,CAAC,WAAW,CAAC,WAAW,CAAC;AACtD,MAAI,UAAU,GAAG,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,UAAU,CAAC;;AAEjD,MAAI,mBAAmB,GAAG;AACxB,WAAO,EAAE,IAAI;AACb,WAAO,EAAE,MAAM,EAAE,CAAC,GAAG,EAAE,CAAC,MAAM,EAAE;AAChC,mBAAe,EAAE,eAAe;AAChC,iBAAa,EAAE,aAAa;AAC5B,UAAM,EAAE,MAAM;GACf,CAAC;;AAEF,SAAO,YAAY,CAAC,UAAU,EAAE,MAAM,EAAE,eAAe,EAAE,aAAa,EAAE,gBAAgB,EAAE,QAAQ,EAAE,QAAQ,EAAE,cAAc,EAAE,UAAU,CAAC,CACxI,IAAI,CAAC,UAAS,SAAS,EAAE;AACxB,WAAO,YAAY,CAAC,SAAS,CAAC,CAAC;GAChC,CAAC,CACD,IAAI,CAAC,UAAS,eAAe,EAAE;AAC9B,uBAAmB,CAAC,OAAO,GAAG,eAAe,CAAC;AAC9C,WAAO,mBAAmB,CAAC;GAC5B,CAAC,SACI,CAAC,UAAS,GAAG,EAAE;AACnB,uBAAmB,CAAC,OAAO,GAAG,KAAK,CAAC;AACpC,uBAAmB,CAAC,YAAY,GAAG,GAAG,CAAC;AACvC,WAAO,CAAC,GAAG,CAAC,gCAAgC,GAAG,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,CAAC,CAAC;AACpE,WAAO,mBAAmB,CAAC;GAC5B,CAAC,CAAC;CACJ,CAAC;;AAEF,gBAAgB,CAAC,SAAS,CAAC,iBAAiB,GAAG,UAAS,cAAc,EAAE;AACtE,MAAI,KAAK,GAAG,IAAI,CAAC;AACjB,OAAK,CAAC,OAAO,GAAG,IAAI,SAAS,CAAC,aAAa,CAAC,cAAc,CAAC,WAAW,CAAC,CAAC;AACxE,MAAI,eAAe,GAAG,MAAM,EAAE,CAAC,GAAG,EAAE,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,MAAM,CAAC,CAAC,MAAM,EAAE,CAAC;AAC7E,MAAI,aAAa,GAAG,MAAM,EAAE,CAAC,GAAG,EAAE,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC,MAAM,EAAE,CAAC;AAC3D,SAAO,KAAK,CAAC,YAAY,CAAC,CAAC,KAAK,CAAC,OAAO,CAAC,WAAW,CAAC,KAAK,CAAC,EAAE,eAAe,EAAE,aAAa,EAAE,EAAE,CAAC,CAC/F,IAAI,CAAC,UAAS,IAAI,EAAE;AACnB,QAAI,IAAI,CAAC,OAAO,IAAI,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,EAAE;;AAEnC,aAAO,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC;KACxB,MAAM;AACL,aAAO,IAAI,CAAC;KACb;GACF,CAAC,CAAC;CACJ,CAAC","file":"clAdapters/office365Adapter.js","sourcesContent":["'use strict';\n\nvar uuid = require('node-uuid');\nvar crypto = require('crypto');\nvar rp = require('request-promise');\nvar util = require('util');\nvar BaseAdapter = require('./baseAdapter');\nvar Office365 = require('./office365-js.js');\nvar moment = require('moment');\n\n/**\n * Office365Adapter\n *\n * @class\n * @return {Office365Adapter}\n */\nvar Office365Adapter = module.exports = function Office365Adapter() {\n  BaseAdapter.call(this);\n};\n\nutil.inherits(Office365Adapter, BaseAdapter);\n\n/**\n * @override\n */\nOffice365Adapter.prototype.init = function() {\n  var _this = this;\n  this._config = new Office365.Configuration(this.credentials);\n  this._service = new Office365.Service(this._config);\n  return this._service\n    .init()\n    .then(function( /*client*/ ) {\n      var msg = 'Successfully initialized Office365 for email: %s';\n      console.log(msg, _this.credentials.email);\n      return _this;\n    });\n};\n\n/**\n * @override\n */\nOffice365Adapter.prototype.reset = function() {\n  delete this._config;\n  delete this._service;\n};\n\nvar getUserEmails = function(apiVersion, email, filterStartDate, filterEndDate, additionalFields, result, token, pageToGet) {\n  var recordsPerPage = 25;\n  var maxPages = 20;\n  pageToGet = pageToGet || 1;\n  var skip = ((pageToGet -1) * recordsPerPage) + 1;\n  var emailRequestOptions = {\n    method: 'GET',\n    uri: 'https://outlook.office365.com/api/v' + apiVersion + '/users(\\'' + email + '\\')/messages?$top=' + recordsPerPage + '&$skip=' + skip + '&$filter=IsDraft eq false and DateTimeSent ge ' + filterStartDate.toISOString().substring(0, 10) + ' and DateTimeSent lt ' + filterEndDate.toISOString().substring(0, 10) + '&$select=Id,Categories,DateTimeCreated,Subject,Importance,HasAttachments,ParentFolderId,From,Sender,ToRecipients,CcRecipients,BccRecipients,ReplyTo,ConversationId,DateTimeReceived,DateTimeSent,IsDeliveryReceiptRequested,IsReadReceiptRequested,IsRead' + additionalFields,\n    headers : {\n      Authorization: 'Bearer ' + token,\n      Accept: 'application/json;odata.metadata=none'\n    }\n  };\n  return rp(emailRequestOptions)\n  .then(function(body) {\n    result.success = true;\n    var parsedBody = JSON.parse(body);\n\n    if (parsedBody && pageToGet === 1) {\n      result.data = parsedBody;\n    } else if (parsedBody.value && pageToGet > 1) {\n      result.data.value = result.data.value.concat(parsedBody.value);\n    }\n\n    if (parsedBody && parsedBody.value.length === recordsPerPage && pageToGet <= maxPages) {\n      return getUserEmails(apiVersion, email, filterStartDate, filterEndDate, additionalFields, result, token, pageToGet + 1);\n    } else {\n      return true;\n    }\n  })\n  .catch(function(err) {\n    result.success = false;\n    if (err.name === 'StatusCodeError') {\n      var entireMessage = err.message;\n      var messageJson = entireMessage.replace(err.statusCode + ' - ', '');\n      var messageData = JSON.parse(messageJson.replace(new RegExp('\\\\\"', 'g'),'\"'));\n      result.errorMessage = messageData.error.message;\n    } else {\n      result.errorMessage = JSON.stringify(err);\n    }\n    return true;\n  });\n};\n\nvar getAccessToken = function(apiVersion, clientId, tenantId, certThumbprint, privateKey) {\n  var tokenRequestUrl = 'https://login.microsoftonline.com/' + tenantId + '/oauth2/token?api-version=' + apiVersion;\n\n  var jwtHeader = {\n    'alg': 'RS256',\n    'x5t': certThumbprint\n  };\n\n  var jwtPayload = {\n    'aud': tokenRequestUrl,\n    'exp': ((new Date()).getTime() / 1000) + 360000, // add X hours\n    'iss': clientId,\n    'jti': uuid.v4(),\n    'nbf': ((new Date()).getTime() / 1000) - 360000, // add -X hours\n    'sub': clientId\n  };\n\n  var encodedJwtHeader = new Buffer(JSON.stringify(jwtHeader)).toString('base64');\n  var encodedJwtPayload = new Buffer(JSON.stringify(jwtPayload)).toString('base64');\n  var stringToSign = encodedJwtHeader + '.' + encodedJwtPayload;\n\n  //sign it!\n  var signer = crypto.createSign('RSA-SHA256');\n  signer.update(stringToSign);\n  var encodedSignedJwtInfo = signer.sign(privateKey, 'base64');\n\n  //define assertion\n  var clientAssertion = encodedJwtHeader + '.' + encodedJwtPayload + '.' + encodedSignedJwtInfo;\n\n  var tokenRequestFormData = {\n    client_id: clientId,\n    client_assertion_type: 'urn:ietf:params:oauth:client-assertion-type:jwt-bearer',\n    grant_type: 'client_credentials',\n    resource: 'https://outlook.office365.com/',\n    client_assertion: clientAssertion\n  };\n\n  var tokenRequestOptions = {\n    method: 'POST',\n    port: 443,\n    uri: tokenRequestUrl,\n    formData: tokenRequestFormData,\n  };\n\n  return rp(tokenRequestOptions)\n  .then(function(body) {\n    var tokenData = JSON.parse(body);\n    if (tokenData && tokenData.access_token) {\n      var accessToken = tokenData.access_token;\n      return accessToken;\n    } else {\n      return Promise.reject('Could not get access token.');\n    }\n  })\n  .catch(function(err) {\n    var tokenData = JSON.parse(JSON.stringify(err));\n    if (tokenData.name === 'StatusCodeError') {\n      var entireMessage = tokenData.message;\n      var messageJson = entireMessage.replace(tokenData.statusCode + ' - ', '');\n      var messageData = JSON.parse(messageJson.replace(new RegExp('\\\\\"', 'g'),'\"'));\n      //console.log('-----');\n      //console.log(messageData);\n      return Promise.reject(messageData);\n    } else {\n      return Promise.reject(err);\n    }\n  });\n};\n\nvar extractDataFromEmailMessage = function(emailMessage, mapping) {\n  if (mapping === '') {\n    return '';\n  } else if (mapping.indexOf('.') === -1) {\n    return emailMessage[mapping];\n  } else {\n    //drill into object to grab the value we need\n    var nestedPropertyArray = mapping.split('.');\n    var returnVal = emailMessage[nestedPropertyArray[0]];\n    if (returnVal) {\n      for (var i = 1; i < nestedPropertyArray.length; i++) {\n        returnVal = returnVal[nestedPropertyArray[i]];\n        if (!returnVal) {\n          return returnVal;\n        }\n      }\n    }\n    return returnVal;\n  }\n};\n\nvar mapEmailData = function(emailData) {\n  var mapping = {\n    'emails': 'value',\n    'messageId': 'Id',\n    'conversationId': 'ConversationId',\n    'dateTimeSent': 'DateTimeSent',\n    'dateTimeReceived': 'DateTimeReceived',\n    'importance': 'Importance',\n    'folderId': 'ParentFolderId',\n    'folderName': '',\n    'categories': 'Categories',\n    'contentType': 'Body.ContentType',\n    'subject': 'Subject',\n    'bodyPreview': 'BodyPreview',\n    'body': 'Body.Content',\n    'fromAddress': 'From.EmailAddress.Address',\n    'fromName': 'From.EmailAddress.Name',\n    'toRecipients': 'ToRecipients',\n    'toRecipientAddress': 'EmailAddress.Address',\n    'toRecipientName': 'EmailAddress.Name',\n    'ccRecipients': 'CcRecipients',\n    'ccRecipientAddress': 'EmailAddress.Address',\n    'ccRecipientName': 'EmailAddress.Name',\n    'bccRecipients': 'BccRecipients',\n    'bccRecipientAddress': 'EmailAddress.Address',\n    'bccRecipientName': 'EmailAddress.Name',\n    'isDeliveryReceiptRequested': 'IsDeliveryReceiptRequested',\n    'isReadReceiptRequested': 'IsReadReceiptRequested',\n    'hasAttachments': 'HasAttachments',\n    'isDraft': 'IsDraft',\n    'isRead': 'IsRead'\n  };\n\n  var mappedData = [];\n\n  for (var userIter = 0; userIter < emailData.length; userIter++) {\n    var mappedUser = {\n      email: emailData[userIter].email,\n      filterStartDate: emailData[userIter].filterStartDate,\n      filterEndDate: emailData[userIter].filterEndDate,\n      data: [],\n      success: emailData[userIter].success,\n      errorMessage: emailData[userIter].errorMessage\n    };\n\n    if (emailData[userIter].success) {\n      for (var i = 0; i < emailData[userIter].data[mapping.emails].length; i++) {\n        var originalEmailMessage = emailData[userIter].data[mapping.emails][i];\n        var mappedEmailMessage = {};\n\n        //get top-level scalars\n        mappedEmailMessage.messageId = extractDataFromEmailMessage(originalEmailMessage, mapping.messageId);\n        mappedEmailMessage.conversationId = extractDataFromEmailMessage(originalEmailMessage, mapping.conversationId);\n        mappedEmailMessage.dateTimeSent = new Date(extractDataFromEmailMessage(originalEmailMessage, mapping.dateTimeSent));\n        mappedEmailMessage.dateTimeReceived = new Date(extractDataFromEmailMessage(originalEmailMessage, mapping.dateTimeReceived));\n        mappedEmailMessage.importance = extractDataFromEmailMessage(originalEmailMessage, mapping.importance);\n        mappedEmailMessage.folderId = extractDataFromEmailMessage(originalEmailMessage, mapping.folderId);\n        //mappedEmailMessage.folderName = extractDataFromEmailMessage(originalEmailMessage, mapping.folderName);\n        mappedEmailMessage.categories = extractDataFromEmailMessage(originalEmailMessage, mapping.categories);\n        mappedEmailMessage.contentType = extractDataFromEmailMessage(originalEmailMessage, mapping.contentType);\n        mappedEmailMessage.subject = extractDataFromEmailMessage(originalEmailMessage, mapping.subject);\n        mappedEmailMessage.bodyPreview = extractDataFromEmailMessage(originalEmailMessage, mapping.bodyPreview);\n        mappedEmailMessage.body = extractDataFromEmailMessage(originalEmailMessage, mapping.body);\n        mappedEmailMessage.isDeliveryReceiptRequested = extractDataFromEmailMessage(originalEmailMessage, mapping.isDeliveryReceiptRequested);\n        mappedEmailMessage.isReadReceiptRequested = extractDataFromEmailMessage(originalEmailMessage, mapping.isReadReceiptRequested);\n        mappedEmailMessage.hasAttachments = extractDataFromEmailMessage(originalEmailMessage, mapping.hasAttachments);\n        mappedEmailMessage.isDraft = extractDataFromEmailMessage(originalEmailMessage, mapping.isDraft);\n        mappedEmailMessage.isRead = extractDataFromEmailMessage(originalEmailMessage, mapping.isRead);\n\n        mappedEmailMessage.fromAddress = extractDataFromEmailMessage(originalEmailMessage, mapping.fromAddress);\n        mappedEmailMessage.fromName = extractDataFromEmailMessage(originalEmailMessage, mapping.fromName);\n\n        //get arrays\n        var j = 0;\n\n        //to\n        mappedEmailMessage.toRecipients = [];\n        for (j = 0; j < originalEmailMessage[mapping.toRecipients].length; j++) {\n          mappedEmailMessage.toRecipients.push({\n            address: extractDataFromEmailMessage(originalEmailMessage[mapping.toRecipients][j], mapping.toRecipientAddress),\n            name: extractDataFromEmailMessage(originalEmailMessage[mapping.toRecipients][j], mapping.toRecipientName)\n          });\n        }\n\n        //cc\n        mappedEmailMessage.ccRecipients = [];\n        for (j = 0; j < originalEmailMessage[mapping.ccRecipients].length; j++) {\n          mappedEmailMessage.ccRecipients.push({\n            address: extractDataFromEmailMessage(originalEmailMessage[mapping.ccRecipients][j], mapping.ccRecipientAddress),\n            name: extractDataFromEmailMessage(originalEmailMessage[mapping.ccRecipients][j], mapping.ccRecipientName)\n          });\n        }\n\n        //bcc\n        mappedEmailMessage.bccRecipients = [];\n        for (j = 0; j < originalEmailMessage[mapping.bccRecipients].length; j++) {\n          mappedEmailMessage.bccRecipients.push({\n            address: extractDataFromEmailMessage(originalEmailMessage[mapping.bccRecipients][j], mapping.bccRecipientAddress),\n            name: extractDataFromEmailMessage(originalEmailMessage[mapping.bccRecipients][j], mapping.bccRecipientName)\n          });\n        }\n\n        mappedUser.data.push(mappedEmailMessage);\n      }\n    }\n    mappedData.push(mappedUser);\n  }\n\n  return mappedData;\n};\n\nvar getEmailData = function(apiVersion, emails, filterStartDate, filterEndDate, additionalFields, clientId, tenantId, certThumbprint, privateKey) {\n  return getAccessToken(apiVersion, clientId, tenantId, certThumbprint, privateKey)\n  .then(function(accessToken) {\n    var emailResults = [];\n    var emailResultPromises = [];\n    var emailIter = 0;\n    for (emailIter = 0; emailIter < emails.length; emailIter++) {\n      emailResults[emailIter] = {email: emails[emailIter], filterStartDate: filterStartDate, filterEndDate: filterEndDate};\n      emailResultPromises.push(getUserEmails(apiVersion, emails[emailIter], filterStartDate, filterEndDate, additionalFields, emailResults[emailIter], accessToken));\n    }\n\n    return Promise.all(emailResultPromises)\n    .then(function() {\n      return emailResults;\n    });\n  });\n};\n\nOffice365Adapter.prototype.getBatchData = function(emails, filterStartDate, filterEndDate, additionalFields) {\n  var clientId = this._config.credentials.clientId;\n  var tenantId = this._config.credentials.tenantId;\n  var certThumbprint = this._config.credentials.certificateThumbprint;\n  var privateKey = this._config.credentials.certificate;\n  var apiVersion = this._config.options.apiVersion;\n\n  var dataAdapterRunStats = {\n    success: true,\n    runDate: moment().utc().toDate(),\n    filterStartDate: filterStartDate,\n    filterEndDate: filterEndDate,\n    emails: emails\n  };\n\n  return getEmailData(apiVersion, emails, filterStartDate, filterEndDate, additionalFields, clientId, tenantId, certThumbprint, privateKey)\n  .then(function(emailData) {\n    return mapEmailData(emailData);\n  })\n  .then(function(mappedEmailData) {\n    dataAdapterRunStats.results = mappedEmailData;\n    return dataAdapterRunStats;\n  })\n  .catch(function(err) {\n    dataAdapterRunStats.success = false;\n    dataAdapterRunStats.errorMessage = err;\n    console.log('Office365 GetBatchData Error: ' + JSON.stringify(err));\n    return dataAdapterRunStats;\n  });\n};\n\nOffice365Adapter.prototype.runConnectionTest = function(connectionData) {\n  var _this = this;\n  _this._config = new Office365.Configuration(connectionData.credentials);\n  var filterStartDate = moment().utc().startOf('day').add(-1, 'days').toDate();\n  var filterEndDate = moment().utc().startOf('day').toDate();\n  return _this.getBatchData([_this._config.credentials.email], filterStartDate, filterEndDate, '')\n  .then(function(data) {\n    if (data.success && data.results[0]) {\n      //to see if it really worked, we need to pass in the first result\n      return data.results[0];\n    } else {\n      return data;\n    }\n  });\n};\n"],"sourceRoot":"/source/"}